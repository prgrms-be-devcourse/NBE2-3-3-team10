<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¸íƒì†Œ ëª…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
    </style>
    <script>
        const token = sessionStorage.getItem("accessToken");
        const url = "http://localhost:8080";

        window.onload = () => {
            getLaundryShopDetail();
        };

        // function checkAccessToken() {
        //     axios.post(url + '/api/user/check-login', {
        //         headers: {
        //             Authorization: 'Bearer ' + token
        //         }
        //     }).then(res => {
        //         sessionStorage.setItem("accessToken", res.data.accessToken);
        //         getLaundryShopDetail();
        //     }).catch(error => {
        //         alert("ë¡œê·¸ì¸ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
        //         location.href = '/';
        //     });
        // }

        function getLaundryShopDetail() {
            const token = sessionStorage.getItem("accessToken")

            // í˜ì´ì§€ ë¡œë“œê°€ ì™„ë£Œëœ í›„ fetchë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ë°›ì•„ì˜¤ê¸°
            // í˜ì´ì§€ ë¡œë“œê°€ ì™„ë£Œëœ í›„ fetchë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ë°›ì•„ì˜¤ê¸°
            fetch('/api/laundry/' + [[${laundryId}]], {
                method: "GET",
                headers: {
                    Authorization: 'Bearer ' + token
                }
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data); // ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ ì¶œë ¥

                    const handledItems = data.handledItems; // handledItems ì¶”ì¶œ

                    // ì¤‘ë³µëœ í•­ëª© ì œê±°
                    const uniqueItems = Array.from(
                        new Set(handledItems.map(item => item.category))
                    ).map(category => {
                        return handledItems.find(item => item.category === category);
                    });

                    // ë°ì´í„°ë¥¼ í™”ë©´ì— í‘œì‹œ
                    const laundryItemsContainer = document.getElementById('category');
                    uniqueItems.forEach(item => {
                        const itemElement = document.createElement('div');
                        const category = getCategoryEnum(item.category);
                        const src = getCategorySrc(item.category)
                        itemElement.innerHTML = `<img src="${src}" alt="${category}" width="50" height="50">`;
                        laundryItemsContainer.appendChild(itemElement);
                    });

                    const obtn = document.getElementById('obtn');

                    obtn.addEventListener('click', function() {
                        window.location.href = '/customer/order/' + [[${laundryId}]];
                    });

                })
                .catch(error => {
                    console.error('ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                });
        }

        function getCategoryEnum(category) {
            const categoryMap = {
                "SHOES" : "ì‹ ë°œ",
                "PADDING" : "íŒ¨ë”©",
                "PREMIUM_FABRIC" : "í”„ë¦¬ë¯¸ì—„ íŒ¨ë¸Œë¦­",
                "CARRIER_SANITATION" : "ìºë¦¬ì–´ ì†Œë…",
                "COTTON_LAUNDRY" : "ë©´ ì„¸íƒë¬¼",
                "STORAGE_SERVICE" : "ë³´ê´€ ì„œë¹„ìŠ¤",
                "BEDDING" : "ì¹¨êµ¬"
            };
            return categoryMap[category] || "";
        }

        function getCategorySrc(category) {
            const categoryMap = {
                "SHOES" : "https://img.icons8.com/ios-filled/50/00bcd4/shoes.png",
                "PADDING" : "https://img.icons8.com/ios-filled/50/00bcd4/jacket.png",
                "PREMIUM_FABRIC" : "https://img.icons8.com/ios-filled/50/00bcd4/guarantee.png",
                "CARRIER_SANITATION" : "https://img.icons8.com/ios-filled/50/00bcd4/carry-on-bag.png",
                "COTTON_LAUNDRY" : "https://img.icons8.com/ios-filled/50/00bcd4/clothes.png",
                "STORAGE_SERVICE" : "https://img.icons8.com/ios-filled/50/00bcd4/box.png",
                "BEDDING" : "https://img.icons8.com/ios-filled/50/00bcd4/bed.png"
            };
            return categoryMap[category] || "";
        }

    </script>
</head>
<body class="bg-gray-100">
<div class="max-w-md mx-auto bg-white shadow-lg rounded-lg overflow-hidden">
    <div class="flex items-center justify-between p-4">
        <button class="text-gray-500" onclick="location.href='/customer/main'">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
        </button>
        <h1 class="text-lg font-bold" th:text="${laundry.shopName}"></h1>
        <button class="text-gray-500">
            <div class="text-xl">
                <img src="/main/Heart.svg" class="h-[26px] w-[24px]"/>
            </div>
        </button>
    </div>
    <div class="p-4">
        <div class="bg-white p-4 rounded-lg shadow">
            <h2 class="text-xl font-bold" th:text="${laundry.shopName}"></h2>
            <p class="text-gray-500" th:text="${laundry.address}"></p>
            <p class="text-gray-500" >ì „í™” <span role="img" aria-label="phone" th:text="${laundry.phone}">ğŸ“ </span></p>
            <p class="text-gray-500" >íœ´ë¬´:  <span class="text-red-500" th:text="${laundry.nonOperatingDays}"></span></p>
            <div class="flex space-x-4 mt-4" id="category">

            </div>
            <button class="mt-4 w-full bg-blue-500 text-white py-2 rounded-lg" id="obtn">ì„¸íƒ ì‹ ì²­</button>
        </div>
        <div class="mt-4 bg-blue-100 p-4 rounded-lg shadow">
            <p class="text-gray-700"><strong>1234ë‹˜</strong></p>
            <p class="text-gray-700">ë˜ê²Œ ê¹¨ë—í•˜ê²Œ ì˜ í•´ì£¼ì…¨ì–´ìš”. ì •ë§ ì™„ì „ ë§Œì¡±í•´ìš” ã…ã…</p>
        </div>
        <div class="mt-2 bg-gray-200 p-4 rounded-lg shadow">
            <p class="text-gray-700"><strong>1234ë‹˜</strong>, ë§Œì¡±í•˜ì…¨ë‹¤ë‹ˆ ë‹¤í–‰ì´ì—ìš”!</p>
        </div>
    </div>

    <footer class="fixed bottom-0 left-0 right-0 bg-white shadow p-4 flex justify-around overflow-x-auto mx-auto max-w-[448px] rounded-t-lg">
        <button class="flex flex-col items-center text-blue-500" onclick="location.href='/customer/main'">
            <img id = "home" src = "/footer/Home.svg" class = "h-6 w-6"/>
            <span class="text-black text-[10pt] mt-1">í™ˆ</span>
        </button>
        <button class="flex flex-col items-center text-gray-500" onclick="location.href='/customer/orderHistory'" >
            <img id = "bag" src = "/footer/Bag.svg" class = "h-6 w-6"/>
            <span class="text-black text-[10pt] mt-1">ì£¼ë¬¸ë‚´ì—­</span>
        </button>
        <button class="flex flex-col items-center text-gray-500" onclick="location.href='/customer/mypage'">
            <img id = "star" src = "/footer/Star.svg" class = "h-6 w-6"/>
            <span class="text-black text-[10pt] mt-1">ë‚´ ì •ë³´</span>
        </button>
    </footer>
</div>
</body>
</html>